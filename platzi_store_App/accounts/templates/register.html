{% extends 'base.html' %}
{% load static %}

{% block title %}Crear Cuenta - Django Shop{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="auth-card">
        <div class="auth-card-body">
            <div class="text-center mb-4">
            <div class="auth-icon">
                <i class="fas fa-user-plus fa-3x text-purple"></i>
            </div>
            <h2 class="auth-title">Crear Cuenta Nueva</h2>
            <p class="auth-subtitle">Únete a nuestra comunidad</p>
            </div>

            <!-- Mostrar mensajes de error o éxito -->
            {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
            {% endif %}

            <form method="post" novalidate class="auth-form" id="registerForm">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <!-- Username -->
            <div class="mb-3">
                <label for="{{ form.username.id_for_label }}" class="form-label">
                <i class="fas fa-user text-purple"></i> {{ form.username.label }}
                </label>
                <div class="input-group">
                <span class="input-group-text bg-purple text-white"><i class="fas fa-user"></i></span>
                {{ form.username }}
                </div>
                {{ form.username.errors }}
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">
                <i class="fas fa-envelope text-purple"></i> {{ form.email.label }}
                </label>
                <div class="input-group">
                <span class="input-group-text bg-purple text-white"><i class="fas fa-envelope"></i></span>
                {{ form.email }}
                </div>
                {{ form.email.errors }}
            </div>

            <!-- Nombre y Apellido -->
            <div class="row mb-3">
                <div class="col-md-6">
                <label for="{{ form.first_name.id_for_label }}" class="form-label">
                    <i class="fas fa-id-card text-purple"></i> {{ form.first_name.label }}
                </label>
                <div class="input-group">
                    <span class="input-group-text bg-purple text-white"><i class="fas fa-id-card"></i></span>
                    {{ form.first_name }}
                </div>
                {{ form.first_name.errors }}
                </div>
                <div class="col-md-6">
                <label for="{{ form.last_name.id_for_label }}" class="form-label">
                    {{ form.last_name.label }}
                </label>
                <div class="input-group">
                    <span class="input-group-text bg-purple text-white"><i class="fas fa-id-card"></i></span>
                    {{ form.last_name }}
                </div>
                {{ form.last_name.errors }}
                </div>
            </div>

            <!-- Contraseña -->
            <div class="mb-3">
                <label for="{{ form.password1.id_for_label }}" class="form-label">
                <i class="fas fa-lock text-purple"></i> {{ form.password1.label }}
                </label>
                <div class="input-group">
                <span class="input-group-text bg-purple text-white"><i class="fas fa-lock"></i></span>
                {{ form.password1 }}
                </div>
                {{ form.password1.errors }}
            </div>

            <!-- Indicador de fuerza de contraseña -->
            <div class="mb-3">
                <div class="progress">
                    <div id="passwordStrength" class="progress-bar" style="width: 0%;"></div>
                </div>
                <small id="passwordHelp" class="form-text text-muted"></small>
            </div>

            <!-- Confirmar Contraseña -->
            <div class="mb-3">
                <label for="{{ form.password2.id_for_label }}" class="form-label">
                <i class="fas fa-lock text-purple"></i> {{ form.password2.label }}
                </label>
                <div class="input-group">
                <span class="input-group-text bg-purple text-white"><i class="fas fa-lock"></i></span>
                {{ form.password2 }}
                </div>
                {{ form.password2.errors }}
            </div>

            <!-- Indicador de coincidencia de contraseñas -->
            <div class="mb-3">
                <small id="passwordMatch" class="form-text"></small>
            </div>


            <!-- Aceptar términos -->
            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" id="terms" required>
                <label for="terms" class="form-check-label">
                Acepto los <a href="#" class="text-purple">términos</a> y la <a href="#" class="text-purple">política de privacidad</a>.
                </label>
            </div>

            <!-- Botón -->
            <div class="d-grid">
                <button type="submit" class="btn btn-purple btn-lg">
                <i class="fas fa-user-plus"></i> Crear Cuenta
                </button>
            </div>

            <!-- Enlace a login -->
            <div class="text-center mt-3">
                <p class="text-muted">¿Ya tienes una cuenta?</p>
                <a href="{% url 'accounts:login' %}" class="btn btn-outline-purple">
                <i class="fas fa-sign-in-alt"></i> Inicia Sesión
                </a>
            </div>
            </form>
        </div>
        </div>
    </div>
</div>

<style>
/* Estilo morado */
.text-purple { color: #6f42c1 !important; }
.bg-purple { background-color: #6f42c1 !important; }
.btn-purple {
    background: linear-gradient(135deg, #6f42c1, #764ba2);
    border: none;
    border-radius: 12px;
    color: #fff;
    transition: all 0.3s ease;
}
.btn-purple:hover {
    background: linear-gradient(135deg, #764ba2, #6f42c1);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(111, 66, 193, 0.3);
}
.btn-outline-purple {
    border: 2px solid #6f42c1;
    border-radius: 10px;
    color: #6f42c1;
    transition: 0.3s ease;
}
.btn-outline-purple:hover {
    background-color: #6f42c1;
    color: #fff;
}
.auth-card {
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    padding: 2rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const password1 = document.getElementById('{{ form.password1.id_for_label }}');
    const password2 = document.getElementById('{{ form.password2.id_for_label }}');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordHelp = document.getElementById('passwordHelp');
    const passwordMatch = document.getElementById('passwordMatch');
    const acceptTerms = document.getElementById('terms');
    const form = document.getElementById('registerForm');
    const submitBtn = form.querySelector('button[type="submit"]');

    // Toggle de visibilidad
    function setupPasswordToggle(field) {
        const wrapper = field.parentElement;
        const toggleBtn = document.createElement('span');
        toggleBtn.style.cursor = 'pointer';
        toggleBtn.className = 'input-group-text bg-light';
        toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
        wrapper.appendChild(toggleBtn);

        toggleBtn.addEventListener('click', function() {
            if (field.type === 'password') {
                field.type = 'text';
                toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                field.type = 'password';
                toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
            }
        });
    }

    setupPasswordToggle(password1);
    setupPasswordToggle(password2);

    // Fuerza de contraseña
    function calculatePasswordStrength(password) {
        let score = 0;
        let message = 'Muy débil';
        let className = 'bg-danger';
        let textClass = 'text-danger';

        if (password.length >= 8) score += 25;
        if (password.match(/[a-z]/)) score += 25;
        if (password.match(/[A-Z]/)) score += 25;
        if (password.match(/[0-9]/)) score += 12.5;
        if (password.match(/[^a-zA-Z0-9]/)) score += 12.5;

        if (score >= 75) { message = 'Muy fuerte'; className='bg-success'; textClass='text-success'; }
        else if (score >= 50) { message = 'Fuerte'; className='bg-info'; textClass='text-info'; }
        else if (score >= 25) { message = 'Débil'; className='bg-warning'; textClass='text-warning'; }

        return {percentage: Math.min(100, score), message, className, textClass};
    }

    if (password1) {
        password1.addEventListener('input', function() {
            const strength = calculatePasswordStrength(password1.value);
            passwordStrength.style.width = strength.percentage + '%';
            passwordStrength.className = 'progress-bar ' + strength.className;
            passwordHelp.textContent = strength.message;
            passwordHelp.className = 'form-text ' + strength.textClass;
        });
    }

    // Verificar coincidencia
    function checkPasswordMatch() {
        if (!password2) return;
        const pass1 = password1.value;
        const pass2 = password2.value;

        if (pass2.length > 0) {
            if (pass1 === pass2) {
                passwordMatch.innerHTML = '<i class="fas fa-check-circle text-success"></i> Las contraseñas coinciden';
                passwordMatch.className = 'form-text text-success';
            } else {
                passwordMatch.innerHTML = '<i class="fas fa-times-circle text-danger"></i> Las contraseñas no coinciden';
                passwordMatch.className = 'form-text text-danger';
            }
        } else {
            passwordMatch.innerHTML = '';
        }
    }

    password2.addEventListener('input', checkPasswordMatch);
    if (password1) password1.addEventListener('input', checkPasswordMatch);

    // Validación términos al enviar
    if (form) {
        form.addEventListener('submit', function(e) {
            if (acceptTerms && !acceptTerms.checked) {
                e.preventDefault();
                alert('Debes aceptar los términos y condiciones para continuar.');
            }
        });
    }

    // Auto-focus
    const firstField = document.querySelector('.form-control');
    if (firstField) firstField.focus();
});
</script>

{% endblock %}